<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Configure Controller</title>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, sans-serif; }
    .wrap { display: grid; grid-template-columns: 1fr 1fr; min-height: 100vh; }
    .left { background: #f1f5f9; display: flex; align-items: center; justify-content: center; padding: 2rem; } /* brighter */
    .left img { max-width: 100%; height: auto; border-radius: 1rem; box-shadow: 0 8px 24px rgba(0,0,0,.12); }
    .right { padding: 2rem; }
    h1 { margin-top: 0; }
    form { display: grid; gap: 1rem; }
    .row { display: grid; grid-template-columns: 160px 1fr; align-items: center; gap: .75rem; }
    select { padding: .5rem; border: 1px solid #cbd5e1; border-radius: .5rem; width: 100%; }
    button { justify-self: start; padding: .6rem 1rem; border-radius: .5rem; border: 1px solid #cbd5e1; cursor: pointer; }
    .note { color: #475569; margin-bottom: 1rem; }
    .controller-info { background: #e0f2fe; padding: 1rem; border-radius: .5rem; margin-bottom: 1rem; }
    .controller-type { font-weight: 600; color: #0277bd; }
    .pill { display:inline-block; background:#e2e8f0; padding:.2rem .5rem; border-radius:999px; margin-right:.25rem; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="left">
      <img src="{{ url_for('static', filename=controller_image) }}" alt="{{ controller_type }}">
    </div>
    <div class="right">
      <h1>Map buttons to actions</h1>
      
      <div class="controller-info">
        <div class="controller-type">Detected Controller: {{ controller_type }}</div>
        <div>{{ buttons|length }} buttons/inputs available</div>
        <form method="post" action="{{ url_for('redetect_controller') }}" style="margin-top: 0.5rem;">
          <button type="submit" style="padding: 0.3rem 0.6rem; font-size: 0.8rem;">Re-detect Controller</button>
        </form>
      </div>
      
      <p class="note">
        Choose an <strong>action</strong> for each controller input. Actions are loaded from
        {{ 'SQLite' if use_sqlite else 'CSV' }} ({{ actions_source }}).
      </p>

      {% if actions|length == 0 %}
        <p><em>No actions found. Add some to the actions store first.</em></p>
      {% else %}
      <form method="post" action="{{ url_for('save_mapping') }}">
        {% for btn in buttons %}
          <div class="row">
            <div><span class="pill">{{ btn }}</span></div>
            <div>
              <select name="btn_{{ btn }}">
                <option value="">-- Select action --</option>
                {% for a in actions %}
                  <option value="{{ a }}">{{ a }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        {% endfor %}
        <button type="submit">Save mappings</button>
      </form>
      {% endif %}
    </div>
  </div>
</body>
</html>